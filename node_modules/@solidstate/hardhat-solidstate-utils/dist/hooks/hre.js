import { isHardhatCLIRunning, isSolidstateTaskRunning, } from '../lib/execution.js';
import { delay, isFundingRequestReady, updateFundingRequestData, } from '../lib/funding.js';
import { printSolidstateFunding } from '../lib/print.js';
import { isCi } from '@nomicfoundation/hardhat-utils/ci';
let alreadyRun = false;
export default async () => ({
    created: async (context, hre) => {
        // skip if this is not the first hre created
        if (alreadyRun)
            return;
        alreadyRun = true;
        // do not print messages in CI environment
        if (isCi())
            return;
        // do not run in scripts
        if (!(await isHardhatCLIRunning()))
            return;
        // do not run if any solidstate task is being run
        if (isSolidstateTaskRunning())
            return;
        // printing of messages is subject to rate limit
        if (!(await isFundingRequestReady()))
            return;
        printSolidstateFunding();
        await updateFundingRequestData();
        await delay();
    },
});
